# perfd системный демон
Технологические компании всех размеров заинтересованы в оптимизации собственных приложений с целью экономии электроэнергии и обслуживания большего числа пользователей.
Самые крупные компании тратят существенные ресурсы на максимальную оптимизацию собственных приложений и инвестируют в разработку новых методов оптимизации.
К примеру, Google инвестировал в разработку технологий AutoFDO и ThinLTO, Facebook инвестировал в разработку BOLT.
Компании Intel и Apple инвестируют в разработку и улучшение компилятора Clang/LLVM, Red Hat инвестирует в улучшение компилятора GCC.

Многие улучшения, разработанные в корпорациях, напрямую применимы на компьютерах конечных пользователей. Например, улучшения компиляторов GCC и Clang.
С другой стороны, некоторые технологии оказываются плохо применимы к нуждам конечных пользователей ПК, так как опираются на внутреннюю инфраструктуру корпораций.
К таким технологиям относятся системы ускорения BOLT (Facebook) и Propeller (Google). 

## Цель
Разработать систему для автоматического применения технологии BOLT на компьютере конечного пользователя под управлением ОС Linux.

## Задачи
- Изучить методологию замера производительности в ОС Linux.
- Выработать подход к автоматическому сбору профиля и мониторингу производительности.
- Изучить технологии построения клиент-серверных приложений.

## Актуальность
Оптимизация приложений на платформе Linux - актуальная прикладная задача.

## Новизна
- Практическая
  - Разработана методология замера производительности.
  - Реализованы средства автоматического замера производительности (скрипт, обработка результатов).
  - **Реализована система автоматического сбора профильной информации и применения технологии BOLT без участия конечного пользователя.**
- Научная
  - Собраны данные производительности для широкого спектра пользовательских программ (IPC, icache/itlb miss, branch mispredictions).
  - Собраны данные по эффекту применения технологии BOLT к широкому спектру пользовательских программ.
  - Спроектирована система, позволяющая осуществлять обмен профильной информацией между многими компьютерами (либо клиент-серверная, либо peer-to-peer).

## План
1. Выбрать проекты для измерения производительности (Chromium, Clang)
2. Измерить базовую производительность приложения.
3. Разработать системный демон:
- Сбор профильной информации с использованием [Linux perf](https://perf.wiki.kernel.org/index.php/Main_Page) (perf record).
- Анализ применимости оптимизации BOLT к приложению (размер секции кода (.text), количество icache/itlb промахов в кэш, ошибок предсказания переходов).
- Ротация профильной информации: автоматическое очищение старых/неиспользуемых данных: [log rotation](https://en.wikipedia.org/wiki/Log_rotation).
- Применение BOLT к приложению по достижении заданного объема профильной информации.
- Замена оригинального приложения на оптимизированное с использованием символьных ссылок.
- Мониторинг эффективности оптимизаций (анализ производительности до/после: среднее IPC, количество промахов в кэши).
- Обработка ошибок (отслеживание падений BOLT, падений в оптимизированном приложении), исключение приложений из оптимизации, blacklist/whitelist.
4. Разработать систему обмена профильной информацией:
- Спроектировать протокол обмена информацией между участниками, например:
  - клиент запрашивает у сервера наличие профиля для данного приложения (передает хэш приложения)
  - сервер отдает профильную информацию или сообщение об ошибке
  - если множество серверов исполняют одно приложение и на каждом имеется профильная информация, имеет смысл организовать обмен между компьютерами при помощи сети peer-to-peer (протокол BitTorrent):
    - широковещательный запрос по данному хэшу приложения
    - формирование ростера серверов с наличием профиля
    - сервера в ростере начинают обмен профилями, т.ч. каждый сервер держит копию профилей других компьютеров
    - клиент забирает профиль каждого сервера со всех серверов (BitTorrent)
    - на сервере: ротация временных профилей
- Разработать реализацию, протестировать на физическом сервере + одной/двух/N виртуальных машинах, объединенных в локальную сеть.

## Требования
1. Компьютер с Linux, навыки работы в командной строке.
2. Процессор: желательно Интел NHM и выше (наличие LBR).
3. Программирование на Python/Go/любой скриптовый язык (скрипт запуска, обработка результатов, драйвер).

## Трудоёмкость
7/10 и выше
